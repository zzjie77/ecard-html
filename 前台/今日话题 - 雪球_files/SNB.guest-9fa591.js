define("SNB.guest.js",["nav_imeigu.jade.js","nav.jade.js","loginDialog.jade.js"],function(e){function a(e){var a=new Date;a.setTime(a.getTime()-1e4),document.cookie=e+"=a; expires="+a.toGMTString()}e.async("SNB.password.js"),SNB.Guest={clearCookie:function(){a("xq_a_token"),a("xq_r_token"),a("xq_is_login"),$.cookie("xq_a_token",null,{path:"/",domain:"xueqiu.com"}),$.cookie("xq_a_token",null,{path:"/",domain:".xueqiu.com"}),$.cookie("xq_r_token",null,{path:"/",domain:"xueqiu.com"}),$.cookie("xq_r_token",null,{path:"/",domain:".xueqiu.com"}),$.cookie("xq_is_login",null,{path:"/",domain:"xueqiu.com"}),$.cookie("xq_is_login",null,{path:"/",domain:".xueqiu.com"})},loginIn:function(e,a,i,t,n,o,s){SNB.Guest.clearCookie(),$.ajax("/user/login",{type:"post",data:{username:e,areacode:a,telephone:i,remember_me:n||0,password:SNB.Password.encryPw(t,e)},error:function(e){var a={};try{a=$.parseJSON(e.responseText)}catch(i){}$.isFunction(s)&&s(a)}}).done(function(e){$.isFunction(o)&&o(e)})},applyRegister:function(e,a,i,t,n,o,s,l){var r=$.trim(e.val()),c=function(){$("body").on("click",".login_xueqiu",function(e){e.preventDefault(),SNB.Guest.showLoginDialog(function(){location.href=SNB.domain.host})})};SNB.Util.verifyEmail(r,function(u){u.success?SNB.post("/account/signup_by_email.json",{email:r,nickname:a,passwd1:SNB.Password.encryPw(i,r),passwd2:SNB.Password.encryPw(t,r),verify_code:l||""},function(e){o.hide(),e.success&&(location.href="/account/regSuc?email="+encodeURIComponent(r))},function(e){switch(SNB.data.submitting=!1,o.hide(),e.error_code){case"21715":n.text("该帐号涉嫌恶意注册已被禁用。如需帮助，请发邮件至：service@xueqiu.com");break;case"22601":n.text("您注册过于频繁，请稍后再试");break;case"20021":n.html("该邮箱已经注册，<a href='#' class ='login_xueqiu'>请登录雪球</a>"),c();break;case"22617":$(".verify-code").find(".reload-code").trigger("click")}n.text(e.error_description)}):(o.hide(),SNB.data.submitting=!1,s.html('该邮箱已经注册，<a href="#" class ="login_xueqiu">请登录雪球</a>'),c(),e.focus())})},updateLoginState:function(a){var i=a.profile_image_url&&a.profile_image_url.split(",");a.profile_image_url=i&&i.length>=3?i[2]:"community/default/avatar.png!50x50.png";var t={currentUser:a,id:$body.attr("id")||"",domain:SNB.domain},n=SNB.data.loginIn_imeigu?e("./nav_imeigu.jade")(t):e("./nav.jade")(t),o=$(".navbar.navbar-fixed-top");if(o.find(".notlogined").remove(),SNB.currentUser=a,0===o.find(".nav_logined").length){n=$(n);var s=o.find(".search");if(s.length>0){var l=n.find(".search");l.after(s),l.remove()}o.find("#logo").after(n)}},updateOverlayLogin:function(){var e=$(".inputArea");e.removeClass("notlogined").find(".loginDialog").hide().end().find(".ui-widget-overlay").hide().end().find(".commentEditor").removeProp("disabled").height(60)},showLoginDialog:function(a){function i(e,a){var i=$.trim(e.val()),o=$.trim(a.val()),l=t.test(i),r=n.test(i),c=s.test(i);return""===i?(alert("请输入邮箱或手机号码，海外手机号码需要国家区号，如 +82"),e.focus(),!1):l||r||c?o?o.length<6||o.length>16?(alert("密码应该大于6位，小于16位。"),a.focus(),!1):!0:(alert("请输入密码"),a.focus(),!1):(alert("帐号格式不正确"),e.focus(),!1)}SNB.data.show_login_dialog=!0,SNB.data.login_callback=a;var t=/^([0-9a-zA-Z_\.\-\+]+)\@([0-9a-zA-Z\-\.]+)\.([0-9a-zA-Z\.]{1,})$/,n=/^1[3|4|5|8][0-9]\d{4,8}$/,o=/^[0-9]*$/,s=/^(\+\d+|\(?\d+\)?)\d+$/;e.async("SNB.third_oauth.js");var l=$.cookie("last_account"),r=e("./loginDialog.jade");$("#dialog-login").remove(),$("body").findOrAppend("#dialog-login",r);var c=$("#dialog-login");SNB.get("/user/setting/areacode.json",function(e){var a=$("select");$.each(e,function(e,i){var t=$('<option value="'+i.code+'">'+i.name_cn+"</option>");"86"===i.code&&t.val("86").attr("selected","selected"),a.append(t)}),$(".region-code").append(a.html())}),c.dialog({title:"登录",modal:!0,dialogClass:"poploginbox",width:600}).css({padding:"0px"}),SNB.Util.dialog_vertical_middle(c.closest(".ui-dialog")),l&&(l=l.replace(/"([^"]*)"/g,"$1"),c.find("#pop_email").val(l).end().find("#pop_password").focus());"placeholder"in document.createElement("input");c.off("click",".pop_connect_link a").off("blur",".placeholder").off("click","#loginButton").on("click",".pop_connect_link a",function(e){"qq_login"===e.target.id?SNB.third_oauth.oauthLogin_qq({directLogin:!0}):"sina_login"===e.target.id?SNB.third_oauth.oauthLogin("sina"):"wc_login"===e.target.id&&SNB.third_oauth.oauthLogin_wc({directLogin:!0})}).on("blur",".placeholder",function(){var e=$(this),a=e.attr("placeholder");""===e.val()&&e.css("color","#ccc").val(a)}).on("focus",".placeholder",function(){var e=$(this),a=e.attr("placeholder");e.val()===a&&e.css("color","#000").val("")}).on("click",".region-switcher",function(e){e.preventDefault();var a=$(this),i=a.text(),t=a.data("text"),n=c.find(".region-code"),o=$("#pop_email"),s=o.attr("placeholder"),l=o.data("placeholder");return n.toggle().parents("p").toggleClass("abroad"),a.text(t).data("text",i),o.val("").attr("placeholder",l).data("placeholder",s),!1}).on("click","#loginButton",function(e){e.preventDefault();var o=c.find("#pop_email"),l=$.trim(o.val()),r=c.find("#pop_password"),u=$.trim(r.val()),d="",p=c.find(".region-code :selected").val(),h="",f=t.test(l),m=(n.test(l),s.test(l),0);c.find("#login_days").is(":checked")&&(m=1),l===o.attr("placeholder")&&(l=""),u===r.attr("placeholder")&&(u=""),i(o,r)&&(f?d=l:h=l,SNB.Guest.loginIn(d,p,h,u,m,function(e){if($.cookie("xq_is_login")){c.dialog("close"),SNB.Guest.updateLoginState(e.user),SNB.Guest.updateOverlayLogin(),a&&a();var i=e.user.profile+"/";-1!==location.href.search(i)&&(location.href=i)}else alert("无法写入cookies,请检查当前浏览器设置")},function(e){return SNB.Util.failDialog(e.error_description),!1}))}).on("keyup blur","#pop_email",function(){var e=$(this),a=$.trim(e.val()),i=c.find(".err");return a||i.hide(),a.length<2?!1:void(o.test(a)&&!/^1[3|4|5|8]$/.test(a.substr(0,2))?i.show():i.hide())}).on("focus","#pop_email",function(){var e=c.find(".err");e.hide()})}}}),define("nav_imeigu.jade.js",function(require,exports,module){function anonymous(locals,attrs,escape,rethrow,merge){attrs=attrs||jade.attrs,escape=escape||jade.escape,rethrow=rethrow||jade.rethrow,merge=merge||jade.merge;var buf=[];with(locals||{}){var nav_item_mixin=function(e,a,i,t,n){this.block,this.attributes||{},this.escaped||{};t=t||"",buf.push("<li"),buf.push(attrs({title:i,"class":id===e?"active"+t:t},{"class":!0,title:!0})),buf.push("><a"),buf.push(attrs({href:a,target:n},{href:!0,target:!0})),buf.push(">");var o=i;buf.push(escape(null==o?"":o)),buf.push("</a></li>")},nav_wrapper_mixin=function(){this.block,this.attributes||{},this.escaped||{};nav_item_mixin("",domain.host+"/S?exchange=US&industry=%E6%98%8E%E6%98%9F%E8%82%A1","明星股","","_blank"),nav_item_mixin("",domain.host+"/S?exchange=US&industry=%E4%B8%AD%E5%9B%BD%E6%A6%82%E5%BF%B5%E8%82%A1","中国概念股","","_blank"),nav_item_mixin("",domain.host+"/S?exchange=US&industry=%E4%B8%AD%E5%9B%BD%E4%BA%92%E8%81%94%E7%BD%91%E4%BF%A1%E6%81%AF%E6%9C%8D%E5%8A%A1","互联网","","_blank"),nav_item_mixin("",domain.host+"/S?exchange=US&industry=%E4%B8%AD%E5%9B%BD%E7%BD%91%E7%BB%9C%E6%B8%B8%E6%88%8F","网游","","_blank"),nav_item_mixin("",domain.host+"/S?exchange=US&industry=%E4%B8%AD%E5%9B%BD%E6%95%99%E8%82%B2%E5%9F%B9%E8%AE%AD","教育","","_blank"),nav_item_mixin("",domain.host+"/S?exchange=US","全部美股","","_blank"),nav_item_mixin("",domain.host,"雪球","","_blank")};buf.push('<div><ul class="nav">'),nav_wrapper_mixin(),buf.push("</ul></div>")}return buf.join("")}module.exports=anonymous}),define("nav.jade.js",function(require,exports,module){function anonymous(locals,attrs,escape,rethrow,merge){attrs=attrs||jade.attrs,escape=escape||jade.escape,rethrow=rethrow||jade.rethrow,merge=merge||jade.merge;var buf=[];with(locals||{}){var nav_item_mixin=function(e,a,i,t){this.block,this.attributes||{},this.escaped||{};t=t||"",buf.push("<li"),buf.push(attrs({"class":id===e?"active"+t:t},{"class":!0})),buf.push("><a"),buf.push(attrs({href:a},{href:!0})),buf.push(">");var n=i;buf.push(escape(null==n?"":n)),buf.push("</a></li>")},nav_wrapper_mixin=function(){this.block,this.attributes||{},this.escaped||{};nav_item_mixin("my-home","/","首页"),buf.push('<li class="dropdown hots"><a href="/today" data-toggle="dropdown" data-target="#" class="dropdown-toggle">精华<b class="caret"></b></a><ul class="dropdown-menu">'),nav_item_mixin("","/today/all","今日话题"),buf.push('<!--mixin nav-item("","/today/hots","热门讨论")-->'),nav_item_mixin("","/talks/all","雪球访谈"),nav_item_mixin("","/event/rank/gws","实盘马拉松"),nav_item_mixin("","/event/deallist","实盘晒单"),buf.push('</ul></li><li class="dropdown hq"><a href="/hq" data-toggle="dropdown" data-target="#" class="dropdown-toggle">行情<b class="caret"></b></a><ul class="dropdown-menu">'),nav_item_mixin("","/hq","行情中心"),nav_item_mixin("","/hq/screener","筛选器"),nav_item_mixin("","/hq#exchange=P&industry=10_0&firstName=10","私募工场"),nav_item_mixin("","/hq#xgss","新股上市"),buf.push("</ul></li>"),nav_item_mixin("userRecommend","/people","找人","guide_div_two guide_div")},nav_account_logined_mixin=function(e){this.block,this.attributes||{},this.escaped||{};buf.push('<li class="dropdown"><a href="#" data-toggle="dropdown" data-target="#" class="dropdown-toggle">');var a=e.screen_name;buf.push(escape(null==a?"":a)),buf.push('<b class="caret"></b></a><ul class="dropdown-menu"><li><a'),buf.push(attrs({href:e.profile+"/profile"},{href:!0})),buf.push("><img"),buf.push(attrs({src:domain.photo+"/"+e.profile_image_url,width:"30px",height:"30px"},{src:!0,width:!0,height:!0})),buf.push("/>");var a=e.screen_name;buf.push(escape(null==a?"":a)),buf.push("</a></li>"),nav_item_mixin("","/setting/user","个人设置"),nav_item_mixin("","/setting/st_privacy","股票设置"),buf.push('<li><a href="/user/logout" class="exit">退出</a></li></ul></li><li class="dropdown"><a id="btn-notice" href="#" data-toggle="dropdown" data-target="#" class="dropdown-toggle">消息<sup>0</sup><b class="caret"></b></a><ul class="notices-list dropdown-menu"><li class="setting"><a href="/setting/notice"><i></i></a></li><li class="comments"><a href="/comments" class="pjax"><span class="count"></span>收到的评论</a></li><li class="followers"><a href="/follows"><span class="count"></span>新增粉丝</a></li><li class="dm"><a href="/messages"><span class="count"></span>新私信</a></li><li class="mentions"><a href="/atme" class="pjax"><span class="count"></span>@我的</a></li><li class="notices"><a href="#" class="pjax"><span class="count"></span>新公告</a></li><li class="events"><a href="/calendar" class="pjax"><span class="count"></span>事件提醒</a></li><li class="weibo_friends"><a href="/friends?q=weibo" class="pjax"><span class="count"></span>微博好友</a></li><li class="contact_friends"><a href="/friends?q=contacts" class="pjax"><span class="count"></span>通讯录好友</a></li></ul></li>'),e.enableIM&&buf.push('<li class="dropdown"><!--a#btn-open-im(href="#")--><!--  聊天--><!--  sup 0--></li>')};buf.push('<div class="nav_logined"><ul class="nav">'),nav_wrapper_mixin(),buf.push('</ul><div class="search"><form method="get" action="/k"><input id="quick-search" name="q" type="text" autocomplete="off" placeholder="搜索 股票/讨论/用户/群组" class="typeahead"/></form><span class="icon"><i></i></span></div><ul class="nav pull-right account">'),currentUser.id&&nav_account_logined_mixin(currentUser),buf.push("</ul></div>")}return buf.join("")}module.exports=anonymous}),define("loginDialog.jade.js",function(require,exports,module){function anonymous(locals,attrs,escape,rethrow,merge){attrs=attrs||jade.attrs,escape=escape||jade.escape,rethrow=rethrow||jade.rethrow,merge=merge||jade.merge;var buf=[];with(locals||{}){buf.push('<style>.ui-dialog p{\n  margin:10px 0;\n}\n.region-switcher{\n  float:right;\n}\n.region-code{\n  display:none;\n}\n.abroad .region-code{\n  display:inline;\n  margin-right:10px;\n  width:55px;\n}\n.poploginbox.ui-dialog.ui-widget-content .poploginbox_left .abroad #pop_email{\n  width:165px;\n}\n.ui-dialog .title{\n  width:245px;\n  font-size:14px;\n}\n</style><div id="dialog-login" class="dialog-wrapper">');var domain_host="http://xueqiu.com";buf.push('<div class="poploginbox_left"><p class="title"><a href="javascript:void(0);" data-text="邮箱登录" class="region-switcher">海外手机号登录</a>登录雪球</p><form'),buf.push(attrs({id:"loginForm",action:""+domain_host+"/service/login",method:"post","class":"formbox"},{action:!0,method:!0})),buf.push('><p><select class="region-code"></select><input id="pop_email" style="" type="text" name="email" placeholder="邮箱/手机号码" data-placeholder="海外手机号码" class="placeholder"/></p><p><input id="pop_password" name="passwd" type="password" placeholder="密码" class="placeholder"/><span class="lostpw"><a'),buf.push(attrs({href:""+domain_host+"/account/lostpasswd",target:"_blank"},{href:!0,target:!0})),buf.push('>忘记密码？</a></span></p><p><input id="loginButton" type="submit" value="登 录" class="submit"/><input id="login_days" type="checkbox" name="remember_me" value="1" style="margin-left:70px;" checked=""/><label for="login_days">1个月内自动登录</label></p></form><p style="float:left" class="regtxt">或使用合作网站账号登录：</p><div class="pop_connect_link"><ul class="icon_connect"><li><a id="sina_login" href="javascript:;" title="使用新浪微博帐号登录"><span class="icon_sina"></span>微博</a></li><li><a id="qq_login" href="javascript:;" title="使用QQ帐号登录"><span class="icon_qq"></span>QQ</a></li><li><a id="wc_login" href="javascript:;" title="使用微信帐号登录"><span class="icon_wc"></span>微信</a></li></ul></div></div><div class="poploginbox_right"><h4>没有帐号？</h4><p class="regtxt">加入雪球，讨论关注的股票和话题</p><p><a'),buf.push(attrs({href:""+domain_host+"/account/reg","class":"green_button"},{href:!0})),buf.push(">注册</a></p></div></div>")}return buf.join("")}module.exports=anonymous});