define("SNB.repostDialog.js",["SNB.editor"],function(t,e,a){var s=$("#dialog-repost");if(!s.length){var i='<div id="dialog-repost" class="dialog-wrapper" style="display:none"><textarea></textarea><p class="counttxt"><span class="showFaceButton" title="表情">&nbsp;</span><span class="addStock" title="股票">&nbsp</span><span class="wordsRemain"></span></p><p style="text-align:center"><input type="submit" class="submit" value="确定"/><input type="button" class="cancel button" value="取消"/></p></div>';s=$(i).appendTo("body>.temp")}s.find(".cancel").click(function(){s.dialog("close")});var n,o,r=SNB.Util.MAX_STATUS_WORDS,d=s.find(".wordsRemain"),l=function(t){var e=SNB.Util.cleanContent(S.getContent(),!1,S.editor);return t&&(e=e.replace(/&nbsp;/gi," ")),e=e.replace(/<br>/gi,"\n")},u=function(){return SNB.Util.getWordsCount(l(!0))},c=function(){var t=(s.data("ta"),u());$(".ueditor-wrapper, textarea",s).removeClass("error"),t>r?d.html("已超出<em>"+(t-r)+"</em>字").css("color","#C30801"):d.html("还能输入<em>"+(r-t)+"</em>字").css("color","")},p=s.find("textarea"),f=function(){var t=l(),e=s.data("statusId"),a=u();if(t!=n||e!=o){if(n=t,o=e,a>SNB.Util.MAX_STATUS_WORDS)return S.$uew.addClass("error"),!1;s.dialog("close");var i=SNB.Util.isContentSame(t,s.data("default"))?0:1,r=s.data("callback"),d={id:e,status:t,forward:i};"undefined"!=typeof SNB.data.status_module_id&&(d.module_id=SNB.data.status_module_id),SNB.post("/statuses/repost.json",d,function(t){r&&r(t)},function(t){t.status&&200!=t.status&&SNB.Util.failDialog("转发失败")})}};s.find(".submit").click(f);var m=t("SNB.editor.js"),S=m.init(s,{$emotion:$(".showFaceButton",s),$stock:$(".addStock",s),ctrlReturn:!0,submitFunc:f,insertFunc:function(){c()}}),v=$.Deferred(),g=v.promise();p.focus(c),p.bind("keyup",c),s.hide(),e=a.exports=function(t,e,a){{var i=!!t.retweet_status_id&&t.retweeted_status,n=i?t.retweeted_status:t;n.user}s.data("statusId",t.id),s.data("callback",e),s.dialog({modal:"true",width:"520px",title:"转发到我的首页"}),$.browser.isMobile?v.resolve(S):S.editor||S.upgrade({autoheight:!1},function(){$(".ueditor-wrapper",s).height(100),S.editor.addListener("keyup",c),v.resolve(S)});var o=a||"";i&&(o=" //@"+t.user.screen_name+": "+$("<div>"+SNB.Util.reparseContent(t.text)+"</div>").text()),s.data("default",o),g.done(function(t){t.reset(o,!0,!0),c()}),SNB.Util.dialog_vertical_middle(s.closest(".ui-dialog"))}});