define("SNB.today.js",["SNB.status"],function(require,exports,module){function getCookie(t){return document.cookie.length>0&&(c_start=document.cookie.indexOf(t+"="),-1!=c_start)?(c_start=c_start+t.length+1,c_end=document.cookie.indexOf(";",c_start),-1==c_end&&(c_end=document.cookie.length),unescape(document.cookie.substring(c_start,c_end))):!1}var _=SNB.underscore160,BB=SNB.backbone112;require.async("SNB.tipsTalk"),window.Mustache=window.Mustache||function(){var t=function(){};return t.prototype={otag:"{{",ctag:"}}",pragmas:{},buffer:[],pragmas_implemented:{"IMPLICIT-ITERATOR":!0},context:{},render:function(t,e,i,a){if(a||(this.context=e,this.buffer=[]),this.includes("",t)){t=this.render_pragmas(t);var s=this.render_section(t,e,i);if(a)return this.render_tags(s,e,i,a);this.render_tags(s,e,i,a)}else{if(a)return t;this.send(t)}},send:function(t){""!=t&&this.buffer.push(t)},render_pragmas:function(t){if(!this.includes("%",t))return t;var e=this,i=new RegExp(this.otag+"%([\\w-]+) ?([\\w]+=[\\w]+)?"+this.ctag);return t.replace(i,function(t,i,a){if(!e.pragmas_implemented[i])throw{message:"This implementation of mustache doesn't understand the '"+i+"' pragma"};if(e.pragmas[i]={},a){var s=a.split("=");e.pragmas[i][s[0]]=s[1]}return""})},render_partial:function(t,e,i){if(t=this.trim(t),!i||void 0===i[t])throw{message:"unknown_partial '"+t+"'"};return"object"!=typeof e[t]?this.render(i[t],e,i,!0):this.render(i[t],e[t],i,!0)},render_section:function(t,e,i){if(!this.includes("#",t)&&!this.includes("^",t))return t;var a=this,s=new RegExp(this.otag+"(\\^|\\#)\\s*(.+)\\s*"+this.ctag+"\n*([\\s\\S]+?)"+this.otag+"\\/\\s*\\2\\s*"+this.ctag+"\\s*","mg");return t.replace(s,function(t,s,n,r){var l=a.find(n,e);return"^"==s?!l||a.is_array(l)&&0===l.length?a.render(r,e,i,!0):"":"#"==s?a.is_array(l)?a.map(l,function(t){return a.render(r,a.create_context(t),i,!0)}).join(""):a.is_object(l)?a.render(r,a.create_context(l),i,!0):"function"==typeof l?l.call(e,r,function(t){return a.render(t,e,i,!0)}):l?a.render(r,e,i,!0):"":void 0})},render_tags:function(t,e,i,a){for(var s=this,n=function(){return new RegExp(s.otag+"(=|!|>|\\{|%)?([^\\/#\\^]+?)\\1?"+s.ctag+"+","g")},r=n(),l=function(t,a,l){switch(a){case"!":return"";case"=":return s.set_delimiters(l),r=n(),"";case">":return s.render_partial(l,e,i);case"{":return s.find(l,e);default:return s.escape(s.find(l,e))}},c=t.split("\n"),o=0;o<c.length;o++)c[o]=c[o].replace(r,l,this),a||this.send(c[o]);return a?c.join("\n"):void 0},set_delimiters:function(t){var e=t.split(" ");this.otag=this.escape_regex(e[0]),this.ctag=this.escape_regex(e[1])},escape_regex:function(t){if(!arguments.callee.sRE){var e=["/",".","*","+","?","|","(",")","[","]","{","}","\\"];arguments.callee.sRE=new RegExp("(\\"+e.join("|\\")+")","g")}return t.replace(arguments.callee.sRE,"\\$1")},find:function(t,e){function i(t){return t===!1||0===t||t}t=this.trim(t);var a;return i(e[t])?a=e[t]:i(this.context[t])&&(a=this.context[t]),"function"==typeof a?a.apply(e):void 0!==a?a:""},includes:function(t,e){return-1!=e.indexOf(this.otag+t)},escape:function(t){return t=String(null===t?"":t),t.replace(/&(?!\w+;)|["'<>\\]/g,function(t){switch(t){case"&":return"&amp;";case"\\":return"\\\\";case'"':return"&quot;";case"'":return"&#39;";case"<":return"&lt;";case">":return"&gt;";default:return t}})},create_context:function(t){if(this.is_object(t))return t;var e=".";this.pragmas["IMPLICIT-ITERATOR"]&&(e=this.pragmas["IMPLICIT-ITERATOR"].iterator);var i={};return i[e]=t,i},is_object:function(t){return t&&"object"==typeof t},is_array:function(t){return"[object Array]"===Object.prototype.toString.call(t)},trim:function(t){return t.replace(/^\s*|\s*$/g,"")},map:function(t,e){if("function"==typeof t.map)return t.map(e);for(var i=[],a=t.length,s=0;a>s;s++)i.push(e(t[s]));return i}},{name:"mustache.js",version:"0.3.1-dev",to_html:function(e,i,a,s){var n=new t;return s&&(n.send=s),n.render(e,i,a),s?void 0:n.buffer.join("\n")}}}(),function(){SNB.Models.Recommend=Backbone.Model.extend({initialize:function(){var t=this.get("profile_image_url");t=t?t.split(","):"";var e=SNB.domain.photo+"/"+(t.length>3?t[2]:1==t.length?t[0]:"community/default/avatar.png!50x50.png");this.set({img:e});var i=this.get("description");i||(i="");var a=this.get("verified_type");a=a||1,i=SNB.Util.getWordsCount(i)>=26?i.substr(0,25)+"..":i,this.set({description:i,verified_type:a})}}),SNB.Collections.Recommend=Backbone.Collection.extend({model:SNB.Models.Recommend,count:3,parse:function(t){return"object"!=typeof t&&(t=$.parseJSON(t)),t},sync:function(t,e,i){return"read"===t&&(i.url=SNB.domain.base+"/recommend/user/editor.json",i.type="GET",i.dataType="jsonp",i.data={type:0,count:i.count?i.count:3},i.exclude&&(i.data.exclude=i.exclude)),$.ajax(i)},initialize:function(){var t=this._add;this._add=function(e){var i=_.pluck(this.models,"id"),a=e.id;return _.include(i,a)||SNB.currentUser.id===a?!1:void t.apply(this,arguments)}}}),SNB.Templates.Recommend="<div class='headpic'><a href='{{profile}}' data-name='{{screen_name}}'><img width='50px' height='50px' src='{{img}}'/></a></div> <div class='content'><div class='op addFriendBtn' title='加关注'><b>＋</b>加关注</div><a href='{{profile}}' target='_blank' data-name='{{screen_name}}'><span class='screen_name'>{{screen_name}}</span>"+'{{#verified}}<img class="vipicon" title="{{verified_description}}" src="'+SNB.domain.static+"/images/vipicon_{{verified_type}}.png\">{{/verified}}</a><div class='userDes'> {{#verified}}{{verified_description}}{{/verified}}{{^verified}}{{{description}}}{{/verified}}</div></div><span class='removeFriendImg leftRemoveFriendImg' title='取消推荐'><span>",SNB.Views.Recommend=Backbone.View.extend({tagName:"li",getUserid:function(){return this.model.get("id")},getUsername:function(){return this.model.get("screen_name")},events:{"click .addFriendBtn":"add","click .removeFriendImg":"del"},render:function(){return $(this.el).css("position","relative").html(Mustache.to_html(SNB.Templates.Recommend,this.model.toJSON())).hover(function(){$(this).find(".removeFriendImg").toggle()}),this},add:function(t){t.preventDefault();var e=this,i={id:e.getUserid(),name:e.getUsername()};SNB.Util.checkLogin(function(){SNB.Util.addFriend(i,function(){e.$(".addFriendBtn").removeClass("addFriendBtn").text("已关注").addClass("addedFriend").attr("title","已关注"),e.collection.remove(e.model),e.collection.fetch({add:!0,count:1,exclude:e.collection.pluck("id").toString(),success:function(t,i){"object"!=typeof i&&(i=$.parseJSON(i)),setTimeout(function(){1===i.length?$(e.el).fadeOut("slow",function(){$(e.el).replaceWith(new SNB.Views.Recommend({model:t.at(t.length-1),collection:e.collection}).render().el).hide().fadeIn()}):0===e.collection.length?$(e.el).html("暂时没有更多推荐了,你可以多关注一些股票,之后这里还将推荐给你一些有意思的用户!"):$(e.el).remove()},0)}})})},t)},del:function(){var t=this,e=t.model.get("id");t.collection.remove(t.model),SNB.get("/recommend/excludefriend.json",{exclude:e},function(){t.collection.fetch({add:!0,count:1,exclude:t.collection.pluck("id").toString(),success:function(e){$(t.el).fadeOut("slow",function(){$(t.el).replaceWith(new SNB.Views.Recommend({model:e.at(e.length-1),collection:t.collection}).render().el).hide().fadeIn()})}})})}}),SNB.Views.RecommendList=Backbone.View.extend({initialize:function(t){var e=this;this.collection.bind("reset",function(){e.$(".loading").remove(),e.render()}),SNB.log("recommend user list initialize from rendered html"),t.static&&e.collection.each(function(t){new SNB.Views.Recommend({model:t,el:$("#recommend_"+t.id),collection:e.collection})})},events:{"click .changeAnother":"change"},render:function(){var t=this,e=$("<ul class='rightSider-list'></ul>");this.collection.each(function(i){e.append(new SNB.Views.Recommend({model:i,collection:t.collection}).render().el)}),$(this.el).append(e)},change:function(t){t.preventDefault(),this.$(".rightSider-list").replaceWith('<div class="rightSider-list loading"></div>'),this.collection.fetch({count:3})}})}(),window.jade=function(t){return Array.isArray||(Array.isArray=function(t){return"[object Array]"==Object.prototype.toString.call(t)}),Object.keys||(Object.keys=function(t){var e=[];for(var i in t)t.hasOwnProperty(i)&&e.push(i);return e}),t.attrs=function(e){var i=[],a=e.terse;delete e.terse;var s=Object.keys(e),n=s.length;if(n){i.push("");for(var r=0;n>r;++r){var l=s[r],c=e[l];"boolean"==typeof c||null==c?c&&i.push(a?l:l+'="'+l+'"'):i.push("class"==l&&Array.isArray(c)?l+'="'+t.escape(c.join(" "))+'"':l+'="'+t.escape(c)+'"')}}return i.join(" ")},t.escape=function(t){return String(t).replace(/&(?!\w+;)/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")},t.rethrow=function(){},t}({}),function(){function resolveDefs(c,block,def){return("string"==typeof block?block:block.toString()).replace(c.define,function(match,code,assign,value){return 0===code.indexOf("def.")&&(code=code.substring(4)),code in def||(":"===assign?def[code]=value:eval("def[code]="+value)),""}).replace(c.use,function(match,code){var v=eval(code);return v?resolveDefs(c,v,def):v})}window.doT={version:"0.1.6"},doT.templateSettings={evaluate:/\{\{([\s\S]+?)\}\}/g,interpolate:/\{\{=([\s\S]+?)\}\}/g,encode:/\{\{!([\s\S]+?)\}\}/g,use:/\{\{#([\s\S]+?)\}\}/g,define:/\{\{##\s*([\w\.$]+)\s*(\:|=)([\s\S]+?)#\}\}/g,varname:"it",strip:!0,append:!0},doT.template=function(t,e,i){e=e||doT.templateSettings;var a=e.append?"'+(":"';out+=(",s=e.append?")+'":");out+='",n=e.use||e.define?resolveDefs(e,t,i||{}):t;n=("var out='"+(e.strip?n.replace(/\s*<!\[CDATA\[\s*|\s*\]\]>\s*|[\r\n\t]|(\/\*[\s\S]*?\*\/)/g,""):n).replace(/\\/g,"\\\\").replace(/'/g,"\\'").replace(e.interpolate,function(t,e){return a+e.replace(/\\'/g,"'").replace(/\\\\/g,"\\").replace(/[\r\t\n]/g," ")+s}).replace(e.encode,function(t,e){return a+e.replace(/\\'/g,"'").replace(/\\\\/g,"\\").replace(/[\r\t\n]/g," ")+").toString().replace(/&(?!\\w+;)/g, '&#38;').split('<').join('&#60;').split('>').join('&#62;').split('\"').join('&#34;').split(\"'\").join('&#39;').split('/').join('&#47;'"+s}).replace(e.evaluate,function(t,e){return"';"+e.replace(/\\'/g,"'").replace(/\\\\/g,"\\").replace(/[\r\t\n]/g," ")+"out+='"})+"';return out;").replace(/\n/g,"\\n").replace(/\t/g,"\\t").replace(/\r/g,"\\r").split("out+='';").join("").split("var out='';out+=").join("var out=");try{return new Function(e.varname,n)}catch(r){throw"undefined"!=typeof console&&console.log("Could not create a template function: "+n),r}}}(),function(t){t.cookie=function(e,i,a){if(arguments.length>1&&"[object Object]"!==String(i)){if(a=t.extend({},a),(null===i||void 0===i)&&(a.expires=-1),"number"==typeof a.expires){var s=a.expires,n=a.expires=new Date;n.setDate(n.getDate()+s)}return i=String(i),document.cookie=[encodeURIComponent(e),"=",a.raw?i:encodeURIComponent(i),a.expires?"; expires="+a.expires.toUTCString():"",a.path?"; path="+a.path:"",a.domain?"; domain="+a.domain:"",a.secure?"; secure":""].join("")}a=i||{};var r,l=a.raw?function(t){return t}:decodeURIComponent;return(r=new RegExp("(?:^|; )"+encodeURIComponent(e)+"=([^;]*)").exec(document.cookie))?l(r[1]):null}}($),$.prototype.live=$.prototype.live||$.prototype.on,$.browser=$.browser||{},$.browser.mozilla=$.browser.mozilla||/firefox/.test(navigator.userAgent.toLowerCase()),$.browser.webkit=$.browser.webkit||/webkit/.test(navigator.userAgent.toLowerCase()),$.browser.opera=$.browser.opera||/opera/.test(navigator.userAgent.toLowerCase()),$.browser.msie=$.browser.msie||/msie/.test(navigator.userAgent.toLowerCase()),SNB.Util=SNB.Util||{},SNB.Util.formatTime=SNB.Util.formatTime||function(t){if(_.isUndefined(t))return"";var e={Jan:"01",Feb:"02",Mar:"03",Apr:"04",May:"05",Jun:"06",Jul:"07",Aug:"08",Sep:"09",Oct:"10",Nov:"11",Dec:"12"},i=_.isNumber(t)?new Date(t).toString():t,a=i.split(" ");return 1==(a[2]+"").length&&(a[2]="0"+a[2]),a[3]&&/\d{4}/.test(a[3])?[a[3],e[a[1]],a[2]].join("-"):[a[5],e[a[1]],a[2]].join("-")};var $today=this,getAccessToken=function(){return getCookie("xq_a_token")||SNB.data.access_token},loadingCtrl=$("#today_loading"),Pager=function(t,e,i){var a="<div class='pager-wrapper'><ul class='pager'>",s="",n=t-2,r="",l="";for(t="string"==typeof t?parseInt(t):t,e="string"==typeof e?parseInt(e):e;e>=n&&(2>=n-t||5>=n);)n>0&&(s+="<li"+(n===t?" class='active'":"")+"><a data-page='"+n+"' href='?page="+n+r+"'>"+n+"</a></li>"),n++;return 1!=t&&(a+="<li class='last'><a data-page='"+(t-1)+"' href='?page="+(t-1)+r+"'><span>上一页</span><i></i></a></li>",t>3&&(a+="<li><a data-page='1' href='?page=1"+r+"'>1</a></li>",t>4&&(a+="<li>...</li>"))),a+=s,t!=e&&(e>t+2&&(e>t+3&&(a+="<li>...<li>"),n-e!==1&&(a+="<li><a data-page='"+e+"' href='?page="+e+r+"'>"+e+"</a></li>")),l="<li class='next'><a data-page='"+(t+1)+"' href='?page="+(t+1)+r+"'><span>下一页</span><i></i></a></li>"),e>4&&i&&i.jump&&(l='<li title="输入页码 按Enter 进行跳转" class="jump_input"><input style="padding: 6px 0; border: 1px solid #ccc; font-size: 13px; width: 40px; text-align: center;"></li>'+l),a+=l+"</ul></div>"};SNB.Util.getAccessToken=SNB.Util.getAccessToken||getAccessToken,SNB.log=SNB.log||function(){},SNB.Util.getWordsCount=SNB.Util.getWordsCount||function(t){if(_.isUndefined(t))return 0;var e=t.split(""),i=0;$(e).each(function(){this.charCodeAt(0)<256&&i++});var a=t.length-i;return a+Math.round(i/2)};var tab=BB.View.extend({initialize:function(t){$(this.el).length&&(this.tabbar=$(this.el).find(">.tab_bar>.tb_w"),this.tabpanel=$(this.el).find(".tab_panel>.tp_w"),this.tabOptions=["style","curbtn"],this._options={style:1,curbtn:""},_.extend(this,_.pick(_.extend(this._options,t),this.tabOptions)),this.tabbar.parent(".tab_bar").find('[action-data="'+this.curbtn+'"]').length||(this.curbtn=this.tabbar.find("[action-data]:eq(0)").attr("action-data")),this._initBar())},_initBar:function(){this.tabbar.addClass("tb_w"+this.style),this.changePanel(this.curbtn),this._bindEvt()},_bindEvt:function(){var t=this;this.tabbar.bind("click",function(e){if($(e.target).is(".tb_item")){if($(e.target).hasClass("disabled"))return;!$(e.target).hasClass("selected")&&t.changePanel($(e.target).attr("action-data"))}else if($(e.target).parent("a").is(".tb_item")){if($(e.target).parent("a").hasClass("disabled"))return;!$(e.target).parent("a").hasClass("selected")&&t.changePanel($(e.target).parent("a").attr("action-data"))}})},changePanel:function(t,e){var i=this,a=this.tabbar.find('[action-data="'+t+'"]');a.hasClass("selected")||(e||setTimeout(function(){i.trigger("onChange",t)},0),this.tabbar.find(".tb_item").removeClass("selected"),a.addClass("selected"),this.tabpanel.find(">div").css("display","none"),this.tabpanel.find('[action-data="'+a.attr("action-data")+'"]').css("display","block"))}}),list_base_itemView=BB.View.extend({className:"list_item",template:_.template('       <div class="list_item_pic">        <a href="<%= this.model.get("target")%>" target="_blank">        <img src="<%=this.model.get("topic_pic").replace("!custom.jpg","!topic.png")%>" alt="<%= this.model.get("topic_title") %>">        </a>      </div>      <div class="list_item_rb">        <div class="list_item_tit">          <a href="<%= this.model.get("target")%>" target="_blank"><%=this.model.get("topic_title")%></a>        </div>        <p class="list_item_a_s">          <a href="<%= (this.model.get("user").id ? "/"+this.model.get("user").id : this.model.get("target").replace("/"+this.model.get("target").split("/")[3],"")) %>" class="atuhor" target="_blank" data-name="<%= this.model.get("user").screen_name%>" data-id="<%= this.model.get("user").id%>">            <i class="i_icon"></i>            <span><%= this.model.get("user").screen_name%></span>          </a>          <span class="list_item_symbol"><%= this.model.get("topic_symbol") %></span>        </p>        <div class="list_item_desc">          <%=this.model.get("topic_desc") ? this.model.get("topic_desc").replace(/<[^>]*>/g,"").__SubStr(225) :this.model.get("description").__SubStr(225) %>        </div>        <div class="list_item_bottom">          <ul class="item_rib">            <li class="item_reply"><a href="<%= this.model.get("target")%>" target="_blank">评论(<%=this.model.get("reply_count")%>)</a></li>          </ul>          <div class="item_time_source">            <span class="item_time"><%= this.model.get("timeBefore")%></span>          </div>        </div>      </div>    '),initialize:function(t){this.options=t,this.isFirst=!this.options._index,this.isFirst&&$(this.el).css("padding-top",0)},render:function(){return $(this.el).append(this.template()),this}}),list_Base_Ctrl=BB.View.extend({className:"list_container",initialize:function(t){this.options=t,this.collection.bind("reset",$.proxy(this.resetAll,this))},resetAll:function(){this.$el.empty();var t=this;this.collection.each(function(e,i){var a=new list_base_itemView({model:e,_index:i});$(t.el).append(a.render().el)}),loadingCtrl.css("display","none")}}),get_api_url=function(t,e,i,a){var s,n=listTypeArr[t];if(n.subtypes&&"all"!=e){var r=_.find(n.subtypes,function(t){return t.key==e});s=n.api+"&"+obj2Url(r.api_param)}else s=n.api+"&"+obj2Url(n.api_param);return i&&(s+="&page="+i),a&&(s+="&scope="+a),s},list_base_Collection=BB.Collection.extend({initialize:function(t,e){this.options=e},sync:function(){var t=Array.prototype.slice.call(arguments);t[2].url=get_api_url(this.options.view,this.options.subtype,this.options.page),BB.sync.apply(this,t)},fetch:function(t){t=t&&_.clone(t)||{},t.type="GET";var e=this;return t.success||(t.success=function(i,a,s){e[t.add?"add":"reset"](e.parse(i,s),t)}),(this.sync||BB.sync).call(this,"read",this,t)}}),parseUrl=function(t){var e={},i=t.split("&");return $.each(i,function(t,i){var a=i.split("=",2);-1!=["v","page","filter","subtype"].indexOf(a[0])&&(e[a[0]]=a[1])}),e},obj2Url=function(t){var e=[];return $.each(t,function(t,i){e.push(t+"="+i)}),e.join("&")},home_template='     <% _.each(listTypeArr.home.modules,function(m_config,m_key){ %>    <% var module_data = data.list[m_key] %>    <div class="index_item_wrap" id="part-<%=m_key%>">      <div class="item_head">        <span><%= m_config.name %></span>      </div>      <div class="right_w"></div>      <div class="left_w">        <ul class="art_list">        <% _.each(module_data,function(_topic,i){ %>          <% var isFirst = i === 0 %>          <% var isLast = i%3 === 0 %>          <li class="<% isFirst ? print("top") : (isLast ? print("normal last") : print("normal")) %>" >            <a class="topic_pic" target="_blank" href="<%= _topic.target %>">              <img src="<%= _topic.topic_pic.replace("!custom.jpg","!topic.png")%>" alt="<%= _topic.topic_title %>">            </a>            <a class="topic_tit" target="_blank" href="<%= _topic.target %>">              <%= _topic.topic_title || _topic.title || _topic.topic_desc %>            </a>            <div class="topic_desc"><%= isFirst ? _topic.topic_desc.replace(/<[^>]*>/g,"").__SubStr(200) : _topic.topic_desc %></div>            <div class="topic_bp">              <div class="topic_author ellipsis">                <i class="i_icon"></i>                <a href="<%= (_topic.user.id ? "/"+_topic.user.id : _topic.target.replace("/"+_topic.target.split("/")[3],"") ) %>" target="_blank" data-name="<%= _topic.user.screen_name %>" data-id="<%= _topic.user.id %>">                  <%= _topic.user.screen_name %>                </a>              </div>              <% if(isFirst){ %>              <div class="topic_symbol"><%= _topic.topic_symbol %></div>              <% } %>              <a class="reply_count" target="_blank" href="<%= _topic.target %>">评论(<%= _topic.reply_count %>)</a>            </div>          </li>        <% }) %>        </ul>        <a href="<%= m_config.href %>" class="more_list">          <span>更多<%= m_config.name %><% if(m_config.name.indexOf("话题")<0){ print("话题")} %></span>        </a>      </div>    </div>    <% }) %>',rWidget=BB.View.extend({header:_.template('       <div class="widget_tit">        <span class="tit"><%=(this.options.name || "no title")%></span>        <div class="line">          <% if(this.options.more){%>          <a target="_blank" href="<%=(this.options.more || "/hq")%>" class="more">更多</a>          <%}%>        </div>      </div>'),tab_temp:_.template('       <div class="tab_bar">        <div class="tb_w">          <% var that = this; _.each(this.options.tabs,function(tit,i){%>            <a class="tb_item" style="width:<%=width%>px" action-data="tb_<%=i%>"><%=(["zgg","mxg"].indexOf(that.options.widget)>-1 ? SNB.Util.formatTime(new Date(tit).toString()).slice(5) : tit)%></a>          <%})%>        </div>      </div>      <div class="tab_panel">        <div class="tp_w">          <% _.each(this.options.tabs,function(tit,i){%>          <div action-data="tb_<%=i%>"><a style="color:red"><%=tit%>的内容</a></div>          <%})%>        </div>      </div>'),initialize:function(t){this.options=t;var e=this.options.widget.split("/");e.length>1&&_.isArray(listWidgets[e[0]].types[e[1]].api)?this.options.tabs=_.pluck(listWidgets[e[0]].types[e[1]].api,"name"):1==e.length&&_.isArray(listWidgets[e[0]].api)&&(this.options.tabs=_.pluck(listWidgets[e[0]].api,"name")),this._initDom()},_initDom:function(){if($(this.el).prepend(this.header()),this.options.tabs){var t=($(".right_w").width()-1-this.options.tabs.length)/this.options.tabs.length;$(this.el).append(this.tab_temp({width:t})),new tab({el:this.el})}this.options.container.append(this.el),this.init()},init:function(){}}),Widget={};Widget.index_rank=rWidget.extend({template:_.template('       <div class="table">        <ul class="tbody">        <% _.each(this.data,function(_item){ %>         <li class="tr <% print(Number(_item.change)>0?"ti_addition":"ti_lower") %>">            <div class="td t1"><a href="/S/<%=_item.symbol%>" target="_blank" title="<%= _item.name %>"><%= _item.name %></a></div>            <div class="td t2"><span><%= Number(_item.current).toFixed(2) %></span></div>            <div class="td t3"><span><% Number(_item.change)>0 && print("+") %><%= Number(_item.change).toFixed(2) %></span></div>            <div class="td t4"><span><% Number(_item.change)>0 && print("+") %><%= Number(_item.percentage).toFixed(2) %>%</span></div>          </li>        <% }) %>        </ul>      </div>'),className:"widget index_rank",init:function(){this.data=(this.options.data||widget_data[this.options.widget])[0].quotes,$(this.el).append(this.template())}}),Widget.hot_rank=rWidget.extend({template:_.template('       <div class="table">        <ul class="tbody">        <% _.each(this.data,function(_item,i){ %>          <% var ti_limit = _item.quote_change == 0 %>          <li class="tr <% print(Number(_item.quote_change)>0?"ti_addition":"ti_lower") %>">            <div class="td t1">              <i class="no no_<%= i+1 %>"><%= i+1 %></i>              <a href="/S/<%=_item.symbol%>" target="_blank" title="<%= _item.name %>"><%= _item.name %></a>            </div>            <div class="td t2 <% ti_limit && print("ti_limit") %>"><span><%= Number(_item.quote_current).toFixed(2) %></span></div>            <div class="td t3 <% ti_limit && print("ti_limit") %>"><span><% Number(_item.quote_change)>0 && print("+") %><%= Number(_item.quote_change).toFixed(2) %></span></div>            <div class="td t4 <% ti_limit && print("ti_limit") %>"><span><% Number(_item.quote_change)>0 && print("+") %><%= Number(_item.quote_percentage).toFixed(2) %>%</span></div>          </li>        <% }) %>        </ul>      </div>'),className:"widget hot_rank",init:function(){var t=this.options.data||widget_data[this.options.widget]||widget_data[this.options.widget.replace("hot_rank/","hot_ranks/")];t&&(this.data=t[0].ranks,$(this.el).append(this.template()))}}),Widget.zd_rank=rWidget.extend({template:_.template('         <div class="table">          <div class="thead head_bar">            <ul class="tr">              <li class="td t1">股票</li>              <li class="td t2">当前价</li>              <li class="td t3">涨跌额</li>              <li class="td t4">涨跌幅</li>            </ul>          </div>          <div class="tbody">          <% _.each(data,function(d,i){%>            <ul class="tr <% print(Number(d.percentage)>0?"ti_addition":"ti_lower") %>">              <li class="td t1"><a href="/S/<%=d.symbol%>" target="_blank" title="<%=d.name%>"><%=d.name%></a></li>              <li class="td t2"><span><%=Number(d.current).toFixed(2)%></span></li>              <li class="td t3"><span><% Number(d.change)>0 && print("+") %><%=Number(d.change).toFixed(2)%></span></li>              <li class="td t4"><span><% Number(d.change)>0 && print("+") %><%=Number(d.percentage).toFixed(2)%>%</span></li>            </ul>          <% }) %>          </div>        </div>      '),className:"widget zd_rank",init:function(){var t=this;this.data=this.options.data||widget_data[this.options.widget],_.each(this.data,function(e,i){var a=t.template({data:e.ranks});$(t.el).find(".tab_panel .tp_w>div:eq("+i+")").html(a)})}}),Widget.stock_rank=rWidget.extend({template:_.template('       <div class="table">        <div class="thead head_bar">          <ul class="tr">            <li class="td t1">股票</li>            <li class="td t2">当前价</li>            <li class="td t3">涨跌幅</li>            <li class="td t4"><%=tab4key%></li>          </ul>        </div>        <div class="tbody">        <% _.each(data,function(d,i){%>          <ul class="tr <% print(Number(d.percentage)>0?"ti_addition":"ti_lower") %>">            <li class="td t1"><a href="/S/<%=d.symbol%>" target="_blank" title="<%=d.name%>"><%=d.name%></a></li>            <li class="td t2"><span><%=Number(d.current).toFixed(2)%></span></li>            <li class="td t3"><span><% Number(d.percentage)>0 && print("+") %><%=Number(d.percentage).toFixed(2)%>%</span></li>            <li class="td t4"><span><%print(parseInt(d.follow7d || d.tweet7d || d.deal7d))%></span></li>          </ul>        <% }) %>        </div>      </div>    '),className:"widget stock_rank",init:function(){var t=this;this.data=this.options.data||widget_data[this.options.widget],_.each(this.data,function(e,i){var a="stock_rank/global"===t.options.widget?"关注数":["关注数","讨论数","分享数"][i],s=t.template({data:e.ranks,tab4key:a});$(t.el).find(".tab_panel .tp_w>div:eq("+i+")").html(s)})}}),Widget.xgsg=rWidget.extend({template:_.template('       <div class="table">        <div class="thead head_bar">          <ul class="tr">            <li class="td t1">股票</li>            <li class="td t2">申购代码</li>            <li class="td t3">申购日期</li>            <li class="td t4">发行价</li>          </ul>        </div>        <div class="tbody">        <% _.each(this.data,function(d,i){%>          <ul class="tr">            <li class="td t1"><a href="/S/<%=d[0]%>" target="_blank" title="<%=d[1]%>"><%=d[1]%></a></li>            <li class="td t2"><span><%=d[2]%></span></li>            <li class="td t3"><span><%=SNB.Util.formatTime(d[3]).slice(5)%></span></li>            <li class="td t4"><span><%=d[4]%></span></li>          </ul>        <% }) %>        </div>      </div>'),className:"widget xgsg_wrap",init:function(){this.data=(this.options.data||widget_data[this.options.widget])[0].data,$(this.el).append(this.template())}}),Widget.uss_cs=rWidget.extend({template:_.template('       <div class="table">        <div class="thead head_bar">          <ul class="tr">            <li class="td t1">代码</li>            <li class="td t2">公司</li>            <li class="td t3">上市时间</li>            <li class="td t4">上市价</li>          </ul>        </div>        <div class="tbody">        <% _.each(this.data,function(d,i){%>          <ul class="tr">            <li class="td t1"><span title="<%=d.symbol%>"><%=d.symbol%></span></li>            <li class="td t2"><span title="<%=d.company_name%>"><%=d.company_name%></span></li>            <li class="td t3"><span><%=SNB.Util.formatTime(d.ipo_date).slice(5)%></span></li>            <li class="td t4"><span><%=d.price_range%></span></li>          </ul>        <% }) %>        </div>      </div>'),className:"widget uss_cs_wrap",init:function(){this.data=(this.options.data||widget_data[this.options.widget])[0].data,$(this.el).append(this.template())}}),Widget.uss_lc=rWidget.extend({template:_.template('       <div class="table">        <div class="thead head_bar">          <ul class="tr">            <li class="td t1">代码</li>            <li class="td t2">公司</li>            <li class="td t3">上市时间</li>            <li class="td t4">上市价</li>          </ul>        </div>        <div class="tbody">        <% _.each(this.data,function(d,i){%>          <ul class="tr">            <li class="td t1"><a href="/S/<%=d.symbol%>" target="_blank" title="<%=d.symbol%>"><%=d.symbol%></a></li>            <li class="td t2"><a href="/S/<%=d.symbol%>" target="_blank" title="<%=d.company_name%>"><%=d.company_name%></a></li>            <li class="td t3"><span><%=SNB.Util.formatTime(d.ipo_date).slice(5)%></span></li>            <li class="td t4"><span><%=d.ipo_price%></span></li>          </ul>        <% }) %>        </div>      </div>'),className:"widget uss_lc_wrap",init:function(){this.data=(this.options.data||widget_data[this.options.widget])[0].data,$(this.el).append(this.template())}}),Widget.zgg=rWidget.extend({template:_.template('       <div class="table">        <div class="thead head_bar">          <ul class="tr">            <li class="td t1">公司</li>            <li class="td t2">预期每股收益</li>            <li class="td t3">时间</li>          </ul>        </div>        <div class="tbody">        <% _.each(data,function(d,i){%>          <ul class="tr">            <li class="td t1"><a href="/S/<%=d[0]%>" target="_blank" title="<%=d.stock_name%>"><%=d.stock_name%></a></li>            <li class="td t2"><span><%=d.sequence%></span></li>            <li class="td t3"><span>盘中</span></li>          </ul>        <% }) %>        </div>      </div>'),className:"widget zgmx_wrap",init:function(){this.data=this.options.data||widget_data[this.options.widget],_.each(this.data,function(){})}}),Widget.rt_rates=rWidget.extend({template:_.template('       <div class="table">        <div class="thead head_bar">          <ul class="tr">            <li class="td t1">名称</li>            <li class="td t2">最新价</li>            <li class="td t3">涨跌额</li>            <li class="td t4">涨跌幅</li>          </ul>        </div>        <div class="tbody">        <% _.each(this.data,function(d,i){%>          <ul class="tr">            <li class="td t1"><span title="<%=d.name%>"><%=d.name%></span></li>            <li class="td t2"><span><%=Number(d.current).toFixed(2)%></span></li>            <li class="td t3"><span><%=Number(d.change).toFixed(2)%></span></li>            <li class="td t4"><span><%=Number(d.percentage).toFixed(2)%>%</span></li>          </ul>        <% }) %>        </div>      </div>'),className:"widget rt_rates_wrap",init:function(){this.data=(this.options.data||widget_data[this.options.widget])[0].exchangerate,$(this.el).append(this.template())}}),Widget.snb_talk=rWidget.extend({className:"widget snb_talk_wrap",init:function(){var t=this;seajs.use("SNB.tipsTalk",function(){var e=new SNB.Collections.TipsTalk,i=new SNB.Views.TipsTalkList({collection:e,el:$(t.el)});i.el=$(i.el),e.bind("reset",$.proxy(i.render,i)),e.reset((t.options.data||widget_data[t.options.widget])[0])})}}),Widget.snb_users=rWidget.extend({className:"widget snb_users_wrap",init:function(){var t=this,e=new SNB.Collections.Recommend;e.fetch({success:function(){var i=new SNB.Views.RecommendList({el:$(t.el),collection:e});i.render()}})}}),exports.widget=function(t,e){switch(t){case"index_rank/global":case"index_rank/stock-cn":case"index_rank/stock-hk":case"index_rank/stock-us":new Widget.index_rank(e);break;case"hot_rank/global":case"hot_rank/stock-cn":case"hot_rank/stock-hk":case"hot_rank/stock-us":new Widget.hot_rank(e);break;case"zd_rank/stock-cn":case"zd_rank/stock-hk":case"zd_rank/stock-us":new Widget.zd_rank(e);break;case"stock_rank/global":case"stock_rank/stock-cn":case"stock_rank/stock-hk":case"stock_rank/stock-us":new Widget.stock_rank(e);break;case"xgsg":new Widget.xgsg(e);
break;case"uss_cs":new Widget.uss_cs(e);break;case"uss_lc":new Widget.uss_lc(e);break;case"zgg":case"mxg":new Widget.zgg(e);break;case"rt_rates":new Widget.rt_rates(e);break;case"snb_talk":new Widget.snb_talk(e);break;case"snb_users":new Widget.snb_users(e)}},exports.router=BB.Router.extend({routes:{":type(/:subtype)":"listCtrl","(/)":"homeCtrl"},initialize:function(){this.on("route",this.navTo),this.on("refresh",this.listCtrl)},navTo:function(t,e){var i=e[0]&&"all"!=e[0]&&e[0]||"home";return listTypeArr[i]?($(".wrapper .nav_wrap").find("li").removeClass("curr").end().find("li[action-name='"+i+"']").addClass("curr"),document.title=(listTypeArr[i].name||"今日话题")+" - 雪球",void window.scrollTo(0,0)):void this.navigate("")},homeCtrl:function(){loadingCtrl.css("display","none");var t=$(".index_main #view-home");if($(".index_main>div").hide(),t.length)t.show();else{loadingCtrl.css("display","block");var t=$('<div class="wrapper" id="view-home"></div>');$(".index_main").append(t);var e=listTypeArr.home.api+"&"+obj2Url(listTypeArr.home.api_param);$.ajax({url:"http://api.xueqiu.com/"+e,dataType:"jsonp"}).done(function(e){loadingCtrl.css("display","none");var i=_.template(home_template,{data:{list:e}});t.html(i),_.each(listTypeArr.home.modules,function(t,e){_.each(t.widget,function(t){t.container=$("#part-"+e).find(".right_w"),exports.widget(t.widget,t)})})})}},listCtrl:function(t,e){loadingCtrl.css("display","none");var i,a,s={},n=1;try{_.each(window.location.href.split("?")[1].split("&"),function(t){var e=t.split("=");s[e[0]]=e[1]})}catch(r){}if(!listTypeArr[t])return this.navigate("",!0),!1;i=listTypeArr[t].subtypes,i?e&&-1!=_.pluck(i,"key").indexOf(e)||(e=i[0].key):e=void 0,s.page&&parseInt(s.page)&&(n=parseInt(s.page));var l=_.pluck(listTypeArr[t].filter,"key");listTypeArr[t].filter&&(a=s.filter&&-1!=l.indexOf(s.filter)?s.filter:listTypeArr[t].filter[0].key);var c=_.compact([t,e,a,n]).join("_");$(".index_main>div").hide();var o=$(".wrapper[data-vk="+c+"]");if(0===listTypeArr[t].cache_time||0===o.length){loadingCtrl.css("display","block");var d='           <div class="list_subtype_wrap">            <% if(subtype){%>              <ul class="subtypes">              <% _.each(types,function(st){ %>                <li class="subnavli <% if(st["key"] == subtype){ print("curr")} %>" action-key="<%=st["key"]%>">                  <a><%=st["name"]%></a>                </li>              <% })%>              </ul>            <% } %>            <% if(filters){ %>            <div class="list_filter">              <% _.each(filters,function(filter){%>              <a onclick="return console.log(this.href);" href="/today/hots<% if(subtype){ print("/"+subtype) } %>?filter=<%= filter.key %>" class="finav <% if(curfilter===filter.key){ print("curr") } %>"><%= filter.name %></a>              <% }) %>              <i></i>            </div>            <% }%>          </div>          <div class="list_s_con">            <div class="right_w"></div>            <div class="list_wrap"></div>            <div class="list_pager"></div>          </div>';if(o=$('<div data-vk="'+c+'" class="wrapper"></div>'),o.html(_.template(d,{vk:c,types:i,subtype:e,filters:listTypeArr[t].filter,curfilter:a})),e&&o.addClass("has_subtype"),$(".index_main").append(o),["hots","latest"].indexOf(t)>=0){require("SNB.status");var p=new SNB.Collections.Statuses,u=new SNB.Views.StatusList({el:o.find(".list_wrap"),collection:p});p.bind("add",function(){loadingCtrl.css("display","none")}),p.fetch({show:!0,url:get_api_url(t,e,n,a)}),u.render()}else{var p=new list_base_Collection([],{view:t,subtype:e,page:n});new list_Base_Ctrl({collection:p,el:o.find(".list_wrap"),key:t}),p.fetch({add:!1})}_.each(listTypeArr[t].widgets,function(t){t.container=o.find(".right_w"),exports.widget(t.widget,t)}),-1==["hots","latest"].indexOf(t)&&o.find(".list_pager").html(Pager(n,5))}else o.css("display","block"),""===o.find(".list_pager").html()&&o.find(".list_pager").html(Pager(n,5)),0===o.find(".list_s_con .right_w .widget").length&&(o.find(".right_w").find(".widget_loading").empty(),_.each(listTypeArr[t].widgets,function(t){t.container=o.find(".right_w"),exports.widget(t.widget,t)}))}}),exports.bindNav=function(t){$(".wrapper .nav_wrap").delegate("li","click",function(e){var i=$(this).attr("action-name");if(!listTypeArr[i].href){if(e.preventDefault(),$(this).hasClass("curr")&&"latest"==i)return void t.trigger("refresh","latest");var a="home"==i?"":"/"+i;t.navigate(a,!0)}}),$(".index_main").delegate(".subnavli a","click",function(e){e.preventDefault();var i=$(this).closest("li").attr("action-key");i="all"==i||"comment"==i?"":"/"+i;var a=$(".wrapper .nav_wrap").find(".curr").attr("action-name");t.navigate("/"+a+i,!0)}),$(".index_main").delegate(".pager-wrapper .pager>li","click",function(e){e.preventDefault();var i=$(e.target),a=i.attr("data-page")||i.find("a").attr("data-page")||i.closest("a").attr("data-page");if(location.hash)var s=location.hash.substr(1).split("?")[0];else var s=location.pathname.substr(7);a&&(s+="?page="+a),t.navigate(s,!0)})}});