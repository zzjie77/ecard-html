define("widget/TSNB.typeahead.js",["widget/bootstrap/typeahead"],function(e){function t(e,t){var a=[];return n.each(e,function(e,n){t(n)&&a.push(n)}),a}function a(e,t){var a=[];return n.each(e,function(e,n){a.push(n[t])}),a}e("widget/bootstrap/typeahead.js");var n=jQuery;if("undefined"!=typeof n.fn.typeahead){var r=n(".typeahead"),i=!1;r.typeahead({top:4,items:15,match:!1,sort:!1,source:function(e,t){var r=n.trim(n(".typeahead").val()).replace(/&/g,"&amp").replace(/\"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/'/g,"");if(!r)return!1;var i={code:r,size:9,key:"47bce5c74f"},o=n.get("/stock/search.json",i,function(){}),u=n.get("/users/search/suggest.json",{q:r,count:3},function(){});return n.when(o,u).then(function(e,r){e="object"!=typeof e[0]?n.parseJSON(e[0]):e[0],r="object"!=typeof r[0]?n.parseJSON(r[0]):r[0];for(var i=e.stocks,o=a(i,"name"),u=a(i,"code"),l=[],c=0;c<o.length;c++)l.push(o[c]+"("+u[c]+")");return n.each(r.users,function(e,t){l.push({isUser:!0,user:t})}),t(l)})},_render:function(e,a){var r=n(".typeahead"),o=n("<ul>");if(r.val()===r.attr("placeholder")||""===n.trim(r.val()))return a.hide();var u=t(e,function(e){return"object"==typeof e});e=t(e,function(e){return"string"==typeof e}),n.each(u,function(e,t){var a=t.user;a.profile_image_url=SNB.Image.getProfileImage(a.profile_image_url,30);var r=n("<li data-value='"+a.remark+"'><a href='"+a.profile+"' target='_blank'><img src='"+a.profile_image_url+"' width=30 height=30/><span style='margin-left:6px'>"+a.screen_name+(a.remark?"("+a.remark+")":"")+"</span></a></li>");o.append(r)}),e=n(e).map(function(e,t){e=n(a.options.item).attr("data-value",t);var r=e.attr("data-value"),i=r.match(/\(([^(]*)\)$/g);return i=i&&i[0].substr(1,i[0].length-2),e.find("a").html(a.highlighter(t)).attr("href","http://xueqiu.com/S/"+i),e[0]});var l=n("<ul>");e.length&&l.append('<li class="no_menu"><h3 class="stock">股票</h3></li>').append(e);var c=a.query.replace(/&/g,"&amp").replace(/\"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;");return l.append('<li class="no_menu"><h3 class="content">讨论</h3></li><li data-value=\''+c+"'><a href='http://xueqiu.com/k?q="+encodeURIComponent(c)+"'target='_blank'>搜索<strong>&nbsp;"+c+'&nbsp;</strong>相关讨论</a></li><li class="no_menu"><h3 class="content">用户</h3></li>'+o.html()+"<li data-value='"+c+"'><a href='http://xueqiu.com/u?q="+encodeURIComponent(c)+"'target='_blank'>搜索<strong>&nbsp;"+c+"&nbsp;</strong>相关用户</a></li>"),l.find("li:not(.no_menu)").first().addClass("active"),a.$menu.html(l.html()),i===!1&&(i=!0,a.$menu.delegate("a","click",function(){a.$menu.hide()}),n(window).on("focus",function(){a.$element.blur(),a.$menu.hide()})),a},_select:function(e){var t=(e.$menu.find(".active").attr("data-value"),e.$menu.find(".active a").attr("href"));t?window.open(t,"_blank"):e.show()}})}});