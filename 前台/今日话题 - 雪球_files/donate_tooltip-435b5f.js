define("widget/donate_tooltip.js",[],function(){function t(t){var i=_.template('<div class="donate-list"><div class="donate-list-hd"><h4 class="donators-tip">已有<%= people %>人赞助了<%= type %><%= coins %>雪球币</h4></div><div class="donate-list-bd"><ul class="donators-list"><% for (var i=0; i<users.length; i++) { %><li class="donator-item"><a href="<%= users[i].uri %>" target="_blank"><img src="<%= users[i].avatar %>" alt="<%= users[i].name %>" width="30" height="30" /></a><strong><%= users[i].coin %></strong></li><% } %></ul></div></div>');return i(t)}var i,e,o=$("body"),s=".ops .donate, .ops .btn-donate",a={status:"这篇帖子",comment:"这条评论"};o.find(".temp .new-tooltip").length||(i='<div class="new-tooltip"><div class="new-tooltip-arrow above"><div class="new-tooltip-arrow-in"></div><div class="new-tooltip-arrow-out"></div></div><div class="new-tooltip-alpha"></div><div class="new-tooltip-inner"></div><div class="new-tooltip-arrow below"><div class="new-tooltip-arrow-out"></div><div class="new-tooltip-arrow-in"></div></div></div>',o.find(".temp").append(i)),i=o.find(".temp .new-tooltip"),e=i.find(".new-tooltip-inner"),o.on("mouseenter",s,function(){var o=$(this),s=o.data("id"),n=o.is(".donate")?"status":"comment";return o.is(".donate")&&o.parents("#jade-single").length||!o.data("id")||0===o.find(".snow-coin").data("count")?!1:(clearTimeout(o.data("timeout")),o.data("state","in"),void o.data("timeout",setTimeout(function(){"in"===o.data("state")&&SNB.get("/donates/list.json",{to_id:s,to_type:n,distinct:!0,base_profile_user:!0},function(s){var d=0,l=[],r={people:s.length,type:a[n]};_.each(s,function(t){d+=t.snow_coin;var i={uri:t.user.profile,avatar:SNB.domain.photo+"/"+t.user.profile_image_url.split(",")[0]+"!30x30.png",name:t.user.screen_name,coin:t.snow_coin};l.push(i)}),r.coins=d,r.users=l;var v=t(r);e.html(v);var c=e.height(),u=e.width();i.css({width:u+5,height:c+18}).find(".new-tooltip-alpha").css({width:u+8,height:c+8});var p=o.offset(),h=i[0].offsetHeight,f={top:p.top-h,left:p.left};p.top-$(document).scrollTop()<h+41&&(f.top=p.top+o[0].offsetHeight,n="above",i.addClass("above")),p.left+i.width()>$(window).width()&&(f.left=p.left-i.width()+50,i.addClass("right")),i.css(f).css({visibility:"visible",zIndex:1024})})},600)))}).on("mouseleave",s,function(){var t=$(this);clearTimeout(t.data("leave_timeout")),t.data("leave_timeout",setTimeout(function(){return i.hasClass("hover")?!1:(i.css("visibility","hidden").removeClass("above myself right"),void t.data("state","out"))},"200"))}),i.on("mouseleave",function(){i.css("visibility","hidden").removeClass("hover above myself right")}).on("mouseenter",function(){i.addClass("hover")})});