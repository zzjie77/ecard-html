define("widget/global_pin.js",[],function(n,a,i){function e(n){var a=_.template('<div id="dialog-global-pin"><div class="global-pin-bd"><div id="pin-wrap" class="bd-wrap"><h4>把本帖推荐到粉丝首页第一条位置</h4><% if (discount > 0) { %><p><del class="original-price">原价：<%= amount %> 雪球币</del><span class="discount-price"><%= resultPrice %> 雪球币</span><span class="discount">限时优惠 <%= discount %>%</span></p><% } %><% if (balance >= resultPrice) { %><p class="tip">应付：<%= resultPrice %> 雪球币，<span class="balance">帐号余额：<%= balance %> 雪球币</p></p><% } else { %><p class="tip warn">应付：<%= resultPrice %> 雪球币，<span class="balance">帐号余额：<%= balance %> 雪球币，请先购买雪球币</p></p><% } %><div class="global-pin-ft"><% if (balance > resultPrice) { %><a href="#" class="btns btn-confirm" data-amount="<%= amount %>">购买粉丝头条</a><% } else { %><a href="#" class="btns btn-confirm disable" data-amount="<%= amount %>">购买粉丝头条</a><% } %><a href="/c/deposit" target="_blank" class="btn-recharge">购买雪球币</a></div></div><div id="recharge-wrap" class="bd-wrap" style="display:none;"><p>请在新窗口购买雪球币，完成之前请不要关闭此窗口</p><div class="recharge-ft"><a href="#" class="btns btn-done">已完成</a><a href="/c/deposit" target="_blank" class="btns btn-redo">重新购买</a></div></div></div></div>');return $(a(n))}function s(n){return this.init(n)}s.prototype={init:function(n){$.post("/c/balance",function(a){$.post("/valueadded/top/get_price.json",{top_type:0,status_id:n.id},function(i){var s=e({balance:a.snow_coin,amount:i.price,resultPrice:i.resultPrice,discount:100-100*i.discount});s.dialog({modal:!0,title:"粉丝头条",width:400,close:function(){s.dialog("destroy").remove()}}),s.find(".btn-confirm").on("click",function(a){a.preventDefault();var i=$(this);return i.is(".disable")?!1:($.get("/c/pin/session",function(a){var i=a[0].toString();$.post("/c/pin",{top_type:0,status_id:n.id,session_token:i},function(n){s.dialog("close"),n.error_code&&"30004"===n.error_code?SNB.Util.failDialog(n.error_description):SNB.Util.stateDialog("粉丝头条购买成功")})}),!1)}).end().find(".btn-recharge").on("click",function(){$(".bd-wrap").hide(),$("#recharge-wrap").show()}).end().find(".btn-done").on("click",function(a){return a.preventDefault(),$(".bd-wrap").hide(),$("#pin-wrap").show(),$.post("/c/balance",function(a){$.post("/valueadded/top/get_price.json",{top_type:0,status_id:n.id},function(n){var i=s.find("#pin-wrap .tip"),e="应付："+n.resultPrice+"雪球币，";a.snow_coin<n.resultPrice?(e+='<span class="balance">帐号余额：'+a.snow_coin+"雪球币，请先购买雪球币</span>",i.addClass("warn").html(e),s.find(".btn-confirm").addClass("disable")):(e+='<span class="balance">帐号余额：'+a.snow_coin+"雪球币</span>",i.removeClass("warn").html(e),s.find(".btn-confirm").removeClass("disable"))})}),!1})})})}},i.exports=a=function(n){return new s(n)}});