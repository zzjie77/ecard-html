define("widget/profile_pin.js",[],function(i,n,t){function e(i){var n=_.template('<div id="dialog-profile-pin"><div class="profile-pin-bd"><div id="pin-wrap" class="bd-wrap"><h4>将本帖设置在个人主页顶部展示</h4><p>置顶时间：</p><ul><li class="item on" data-day="30">30天</li><li class="item" data-day="60">60天</li><li class="item" data-day="90">90天</li></ul><% if (discount > 0) { %><p class="discount-tip"><del class="original-price">原价：<%= price %>雪球币</del><span class="discount-price"><%= resultPrice %>雪球币</span><span class="discount">限时优惠 <%=  discount %>%</span></p><% } else { %><p class="discount-tip" style="display:none;"><del class="original-price">原价：<%= price %>雪球币</del><span class="discount-price"><%= resultPrice %>雪球币</span><span class="discount">限时优惠 <%=  discount * 100 %>%</span></p><% } %><% if (balance >= resultPrice) { %><p class="tip">应付：<%= resultPrice %>雪球币，帐号余额：<%= balance %>雪球币</p><% } else { %><p class="tip warn">应付：<%= resultPrice %>雪球币，帐号余额：<%= balance %>雪球币，请先购买雪球币</p><% } %><div class="profile-pin-ft"><% if (balance > resultPrice) { %><a href="#" class="btns btn-confirm">购买主页置顶</a><% } else { %><a href="#" class="btns btn-confirm disable">购买主页置顶</a><% } %><a href="/c/deposit" target="_blank" class="btn-recharge">购买雪球币</a></div></div><div id="recharge-wrap" class="bd-wrap" style="display:none;"><p>请在新窗口购买雪球币，完成之前请不要关闭此窗口</p><div class="recharge-ft"><a href="#" class="btns btn-done">已完成</a><a href="/c/deposit" target="_blank" class="btns btn-redo">重新购买</a></div></div></div></div>');return $(n(i))}function s(i){return this.init(i)}function a(i){$.post("/c/balance",function(n){$.post("/valueadded/top/get_price.json",{top_type:1,status_id:i.id},function(t){o=t;var s=e({balance:n.snow_coin,price:t[30].price,resultPrice:t[30].resultPrice,discount:100-100*t[30].discount});s.dialog({modal:!0,title:"个人主页置顶",width:400,close:function(){s.dialog("destroy").remove()}}),s.find(".item").on("click",function(){var i=$(this),n=i.attr("data-day"),t=o[n].resultPrice,e=o[n].price,a=100*o[n].discount,c=s.find(".tip"),r=s.find(".btn-confirm");i.addClass("on").siblings(".item").removeClass("on"),$.post("/c/balance",function(i){var n=i.snow_coin,s="";n>=t?(s="应付:"+t+"雪球币，帐号余额:"+n+"雪球币",c.removeClass("warn"),r.removeClass("disable")):t>n&&(s="应付:"+t+"雪球币，帐号余额:"+n+"雪球币，请先购买雪球币",c.addClass("warn"),r.addClass("disable")),c.text(s),100>a?($(".discount-tip").show(),$(".original-price").text("原价："+e+"雪球币"),$(".discount-price").text(t+"雪球币"),$(".discount").text("限时优惠"+(100-a)+"%")):$(".discount-tip").hide()})}).end().find(".btn-confirm").on("click",function(n){n.preventDefault();var t=$(this);if(t.is(".disable"))return!1;var e=s.find(".on").attr("data-day");return $.get("/c/pin/session",function(n){var t=n[0].toString();$.post("/c/pin",{top_type:1,status_id:i.id,day:e,session_token:t},function(n){s.dialog("close"),n.error_code&&"30004"===n.error_code?SNB.Util.failDialog(n.error_description):$("body").is("#my-profile")?(SNB.Util.stateDialog("主页置顶购买成功"),setTimeout(function(){window.location.reload()},3e3)):(SNB.Util.stateDialog("主页置顶购买成功"),$("#status_"+i.id).find(".profile-pin").addClass("btn-cancel-profile-pin").removeClass("profile-pin").text("取消置顶").end().find(".infos").append('<span class="status-marker status-pin">置顶</span>'))})}),!1}).end().find(".btn-recharge").on("click",function(){$(".bd-wrap").hide(),$("#recharge-wrap").show()}).end().find(".btn-done").on("click",function(i){return i.preventDefault(),$(".bd-wrap").hide(),$("#pin-wrap").show(),s.find(".on").click(),!1})})})}var o={};s.prototype={init:function(i){$.post("/valueadded/top/get.json",{top_type:1},function(n){0===n.status_id?a(i):SNB.Util.confirmDialog("确认将该帖置顶，替换现有置顶贴？",function(){a(i)}).dialog({modal:!0,width:300,minHeight:50})})}},t.exports=n=function(i){return new s(i)}});